<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>「富岳」Open OnDemand利用マニュアル</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet">
</head>
<body>

  <div class="container-fluid">
    <nav class="sidebar bg-body-secondary">
      <h5 class="ps-3 pe-1 d-inline">目次</h5><a href="batch-en.html" style="font-size: 0.75rem;" class="text-decoration-none ms-0">[English]</a>
      <ul class="nav flex-column px-3 py-2">
        <li class="nav-item"><a href="index.html" class="nav-link">1. はじめに</a></li>
        <li class="nav-item"><a href="dashboard.html" class="nav-link">2. 画面構成</a></li>
        <li class="nav-item"><a href="interactive.html" class="nav-link">3. 対話アプリケーション</a></li>
        <li class="nav-item"><a href="batch.html" class="nav-link">4. バッチジョブ</a></li>
        <li class="nav-item"><a href="passenger.html" class="nav-link">5. Passenger Apps</a></li>
        <li class="nav-item ms-3"><a href="passenger.html#file" class="nav-link">5.1. ファイル操作</a></li>
        <li class="nav-item ms-3"><a href="passenger.html#hpci" class="nav-link">5.2. HPCI共用ストレージ</a></li>
        <li class="nav-item ms-3"><a href="passenger.html#gakunin" class="nav-link">5.3. GakuNin RDM</a></li>
        <li class="nav-item ms-3"><a href="passenger.html#shell" class="nav-link">5.4. シェルアクセス</a></li>
        <li class="nav-item ms-3"><a href="passenger.html#composer" class="nav-link">5.5. Open Composer</a></li>
        <li class="nav-item ms-3"><a href="passenger.html#active" class="nav-link">5.6. ジョブのモニタリング</a></li>
        <li class="nav-item ms-3"><a href="passenger.html#budget" class="nav-link">5.7. バジェットの情報</a></li>
        <li class="nav-item ms-3"><a href="passenger.html#disk" class="nav-link">5.8. ディスクの情報</a></li>
        <li class="nav-item"><a href="supplement.html" class="nav-link">6. 補足</a></li>
      </ul>
    </nav>

    <main class="main-content">
      <h2>4. バッチジョブ</h2>
      <p>
        バッチジョブとは、ジョブスケジューラによって非対話的に実行される計算タスクのことです。
        バッチジョブはシェルスクリプトで記述され、必要な計算資源（たとえばノード数や最大実行時間など）は、ジョブスケジューラのディレクティブ（例：<code>#SBATCH -N 4</code>）を用いて明示的に指定されます。
        「富岳」Open OnDemandでは、Open OnDemand上で動作するアプリケーションである<a href="https://github.com/RIKEN-RCCS/OpenComposer/">Open Composer</a>を利用しており、
        下記のバッチジョブのテンプレートを用意しています。
      </p>
      <table class="table">
        <tr><th>Category</th><th>Application</th></tr>
        <tr><td>Climate</td><td>SCALE</td></tr>
        <tr><td>Computer Aided Engineering</td><td>FDS, FFVHC-ACE, FrontFlow (blue/X), FrontISTR, OpenFOAM (Foundation/OpenCFD)</td></tr>
        <tr><td>Condensed Matter Physics</td><td>ALAMODE, AkaiKKR, H&Phi;, mVMC, OpenMX, PHASE/0, Quantum Espresso, SALMON</td></tr>
        <tr><td>Experimental Data Processing</td><td>KIERT&Auml;&Auml;</td></tr>
        <tr><td>Molecular Dynamics</td><td>GENESIS, GROMACS, LAMMPS, MODYLAS, PIMD</td></tr>
        <tr><td>Quantum Chemistry</td><td>ABINIT-MP, Gaussian, NTChem, SMASH</td></tr>
        <tr><td>Quantum Simulation</td><td>braket</td></tr>
        <tr><td>Other</td><td>Fujitsu TCS, Slurm</td></tr>
      </table>
      <p>
        例として、<a href="https://pages.nist.gov/fds-smv/index.html">FDS（Fire Dynamics Simulator）</a>の利用方法を説明します。メニューバーの「Batch Jobs」から「FDS」を選択します。
      </p>
      <img width="400" alt="Click FDS" src="img/fds_click.png">
      <p>
        ジョブスクリプトを生成するためのWebフォームが表示されます。右上はアプリケーション共通の入力項目であり、「Script Location」はジョブスクリプトの保存場所、「Script Name」はジョブスクリプトのファイル名、「Job Name」はジョブの名前（省略可能）を指定します。左下はアプリケーション固有の入力項目であり、入力すると右下のジョブスクリプトが自動更新されます。入力後に「Submit」をクリックすると、「富岳」にジョブが投入されます。
      </p>
      <img width="600" alt="Web form of FDS" src="img/fds_webform.png">
      <p>
      ジョブが正常に投入されると上の方に表示される「History page」へのリンクをクリックします。
      </p>
      <img width="400" alt="Link to Histroy Page" src="img/link_to_history.png">
      <p>
      History pageでは、これまでに投入したジョブの履歴を閲覧することができます。テーブルの各行は1つのジョブの情報を示しています。
      </p>
      <p>
      左上にある「Delete Job」と「Cancel Job」のボタンは、それぞれテーブルからジョブの情報を削除することと実行中のジョブのキャンセルを行います。
      それらの動作を行うためには、テーブルの左端の列にある対応するチェックボックスをオンにする必要があります。
      </p>
      <p>
      右上にあるテキストエリアとラジオボタンは、表に表示されるジョブをフィルタリングするために使用します。
      「Filter」に文字列を入力すると、その文字列に関係するジョブだけが表示されます。
      「All」、「Running」、「Queued」、「Completed」のラジオボタンはジョブの状態を表しており、その状態のジョブだけが表示されます。
     「Fugaku」と「Prepost」のラジオボタンは、それぞれのシステムに投入したジョブだけが表示されます。
      </p>
      <img width="600" alt="Histroy Page" src="img/history.png">
      <p>
      「Job ID」列のリンクをクリックすると、ジョブスケジューラから取得されたプロファイリング情報が表示されます。
      </p>
      <img width="400" alt="Job ID in Histroy Page" src="img/history_jobid.png">
      <p>
     「Application」列のリンクをクリックすると、そのアプリケーションページが開きます。そのリンクの横にあるアイコンは、Open OnDemandに登録されている可視化アプリケーションを表しています。クリックすると、そのアプリケーションを起動するためのWebフォームが起動します。
      </p>
      <p>
      「Script Location」列のリンクをクリックすると、Open OnDemandの<a href="./passenger.html#file">Home Directory</a>が起動します。また、その横のターミナルアイコンをクリックすると、Open OnDemandの<a href="./passenger.html#shell">Shell Access</a>が起動します。
      </p>
      <img width="400" alt="Home Directory" src="img/home_directory.png">
      <img width="400" alt="Shell Access" src="img/shell_access.png">
      <p>
      「Script Name」列のリンクをクリックすると、送信されたシェルスクリプトの内容を表示するウィンドウが開きます。そのウィンドウの「Load Parameters」ボタンをクリックすると、パラメータが読み込まれたアプリケーションのページが開きます。
      </p>
      <img width="400" alt="Load Parameters" src="img/history_load_parameters.png">
    </main>
  </div>

  <footer class="text-muted text-center" style="background-color: darkblue;">
    <p>&copy; RIKEN Center for Computational Science</p>
  </footer>
</body>
</html>
