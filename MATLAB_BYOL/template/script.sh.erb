<%= output_xfce(context.global_prepost_vgl) %>

VERSION=R2023a
MATLAB_ACTIVATE="/vol0004/apps/MATLAB/${VERSION}/bin/activate_matlab.sh"
MATLAB_EXEC="/vol0004/apps/MATLAB/${VERSION}/bin/matlab"

if [ "<%= context.activation %>" == "1" ]; then
  TMPDIR=/tmp ${MATLAB_ACTIVATE} &
else
  if [ "${_VIRTUALGL}" != "" ]; then
    if [ "<%= context.global_working_dir %>" != "" ]; then
      TMPDIR=/tmp ${MATLAB_EXEC} -desktop -nosoftwareopengl -sd "<%= context.global_working_dir %>" &
    else
      TMPDIR=/tmp ${MATLAB_EXEC} -desktop -nosoftwareopengl &
    fi
  else
    if [ "<%= context.global_working_dir %>" != "" ]; then
      TMPDIR=/tmp ${MATLAB_EXEC} -desktop -sd "<%= context.global_working_dir %>" &
    else
      TMPDIR=/tmp ${MATLAB_EXEC} -desktop &
    fi
  fi
fi

${_VIRTUALGL} xfce4-session
fg
